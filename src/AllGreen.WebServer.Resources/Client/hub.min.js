var AllGreen;(function(n){var i=function(){function n(n,t,i){typeof i=="undefined"&&(i=5e3),this.connection=n,this.app=t,this.reconnectTimeout=i,t.setServerStatus("Disconnected")}return n.prototype.connect=function(){return this.hubProxy=this.attachToHub(this.connection,this.app),this.attachToConnectionEvents(this.connection,this.app),this.startConnection(this.connection,this.app),this.hubProxy},n.prototype.attachToHub=function(n,t){var i=n.createHubProxy("runnerHub");i.on("reload",function(){t.log("reloading..."),t.reload()});return i},n.prototype.attachToConnectionEvents=function(n,t){var i=this;n.stateChanged(function(n){t.log("state changed ",n,i.stateString(n.oldState)," -> ",i.stateString(n.newState))}),n.error(function(n){t.log("error",n),t.setServerStatus("Error: "+n)}),n.reconnecting(function(){t.log("reconnecting"),t.setServerStatus("Reconnecting...")}),n.reconnected(function(){t.log("reconnected"),t.setServerStatus("Reconnected")}),n.disconnected(function(){t.log("disconnected"),t.setServerStatus("Disconnected"),t.log("reconnecting in 5s"),setTimeout(function(){i.startConnection(n,t)},i.reconnectTimeout)})},n.prototype.startConnection=function(n,t){var i=this;n.start().done(function(){t.log("connected as "+n.id),t.setServerStatus("Connected"),i.register()})},n.prototype.register=function(){this.hubProxy.invoke("register",this.connection.id,navigator.userAgent)},n.prototype.stateString=function(n){return n===$.signalR.connectionState.connecting?"connecting":n===$.signalR.connectionState.connected?"connected":n===$.signalR.connectionState.reconnecting?"reconnecting":n===$.signalR.connectionState.disconnected?"disconnected":void 0},n}(),t;n.Hub=i,t=function(){function n(n){this.hubProxy=n}return n.prototype.reset=function(){this.hubProxy.invoke("reset",this.hubProxy.connection.id)},n.prototype.started=function(n){this.hubProxy.invoke("started",this.hubProxy.connection.id,n)},n.prototype.specUpdated=function(n){this.hubProxy.invoke("specUpdated",this.hubProxy.connection.id,n)},n.prototype.finished=function(){this.hubProxy.invoke("finished",this.hubProxy.connection.id)},n}(),n.HubReporter=t})(AllGreen||(AllGreen={})),function(){var n=AllGreen.App.getCurrent();if(n!=null){n.log("registering signalR hub");var t=$.hubConnection(),i=new AllGreen.Hub(t,n),r=i.connect();n.registerRunnerReporter(new AllGreen.HubReporter(r))}}()