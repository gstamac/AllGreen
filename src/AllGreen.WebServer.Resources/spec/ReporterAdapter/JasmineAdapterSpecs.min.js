describe("AllGreen JasmineAdapterFactory",function(){it("Creates Jasmine adapter",function(){var t=new AllGreen.JasmineAdapterFactory,n;reporter=jasmine.createSpyObj("reporter",["reset","setServerStatus","setRunnerStatus","setSpecStatus"]),n=t.create(reporter),expect(n).toBeDefined(),expect(n.start).toBeDefined()})});var reporter,adapter,runner,spec,spec2;describe("AllGreen Jasmine Adapter",function(){var n=function(n,t,i){return typeof i=="undefined"&&(i=[]),function(){return{passed:function(){return n},skipped:t,getItems:function(){return i?i:[]}}}},i=function(n){return{type:"log",toString:function(){return n}}},t=function(n,t,i){return{type:"expect",passed:function(){return n},message:t,trace:{stack:i!=null?i:!1}}};beforeEach(function(){jasmine.getEnv().currentSpec.addMatchers({toHaveBeenCalledForSpec:function(n,t,i,r,u,f){var s=this.actual,o={id:n,name:t,suite:jasmine.objectContaining({id:i,name:r}),status:u,steps:[]},e;if(f)for(o.steps=[],e=0;e<f.length;e++)o.steps.push(jasmine.objectContaining(f[e]));return expect(s).toHaveBeenCalledWith(jasmine.objectContaining(o)),!0}}),reporter=jasmine.createSpyObj("reporter",["reset","setServerStatus","setRunnerStatus","setSpecStatus"]),adapter=new AllGreen.JasmineAdapter(reporter);var t={id:881,description:"Suite 1"};spec={id:244,description:"test 1",suite:t,results:n(!1,!1)},spec2={id:344,description:"test 2",suite:t,results:n(!1,!1)}}),afterEach(function(){adapter=null}),it("Resets reporter on runner starting and displays reporter as started",function(){adapter.reportRunnerStarting(runner),expect(reporter.setRunnerStatus).toHaveBeenCalledWith("Running...")}),it("Displays reporter as finished on runner finished",function(){adapter.reportRunnerResults(runner),expect(reporter.setRunnerStatus).toHaveBeenCalledWith("Finished")}),it("Shows started specs as running",function(){adapter.reportSpecStarting(spec),expect(reporter.setSpecStatus).toHaveBeenCalledForSpec(244,"test 1",881,"Suite 1",AllGreen.SpecStatus.Running,null)}),it("Shows passed specs as passed",function(){spec.results=n(!0,!1),adapter.reportSpecResults(spec),expect(reporter.setSpecStatus).toHaveBeenCalledForSpec(244,"test 1",881,"Suite 1",AllGreen.SpecStatus.Passed,null)}),it("Shows failed specs as failed",function(){spec.results=n(!1,!1,[i("log message"),t(!0,"expected something and succeded",""),t(!1,"expected something and failed","trace 1\ntrace 2")]),adapter.reportSpecResults(spec),expect(reporter.setSpecStatus).toHaveBeenCalledForSpec(244,"test 1",881,"Suite 1",AllGreen.SpecStatus.Failed,[{message:"log message"},{message:"expected something and failed",status:AllGreen.SpecStatus.Failed,trace:"trace 1\ntrace 2"}])}),it("Removes jasmine entries from stack",function(){spec.results=n(!1,!1,[t(!1,"msg","jasmine.ExpectationResult@http://localhost:8080/Scripts/jasmine.js:114\ntrace 1\njasmine.Block.prototype.execute@http://localhost:8080/Scripts/jasmine.js:1064\ntrace 2\njasmine.Queue.prototype.next_/onComplete@http://localhost:8080/Scripts/jasmine.js:2092jasmine.Suite.prototype.finish@http://localhost:8080/Scripts/jasmine.js:2478jasmine.Suite.prototype.execute/<@http://localhost:8080/Scripts/jasmine.js:2522")]),adapter.reportSpecResults(spec),expect(reporter.setSpecStatus).toHaveBeenCalledForSpec(244,"test 1",881,"Suite 1",AllGreen.SpecStatus.Failed,[{message:"msg",status:AllGreen.SpecStatus.Failed,trace:"trace 1\ntrace 2"}])}),it("Shows skipped specs as skipped",function(){spec.results=n(!1,!0),adapter.reportSpecResults(spec),expect(reporter.setSpecStatus).toHaveBeenCalledForSpec(244,"test 1",881,"Suite 1",AllGreen.SpecStatus.Skipped,null)}),it("Shows specs from same suite as results from same suite",function(){adapter.reportSpecResults(spec),adapter.reportSpecResults(spec2),expect(reporter.setSpecStatus).toHaveBeenCalledForSpec(244,"test 1",881,"Suite 1",AllGreen.SpecStatus.Failed,null),expect(reporter.setSpecStatus).toHaveBeenCalledForSpec(344,"test 2",881,"Suite 1",AllGreen.SpecStatus.Failed,null)}),it("Shows nested suites",function(){var n={id:981,description:"Suite 2",parentSuite:{id:881,description:"Suite 1"}};spec.suite=n,spec2.suite=n,adapter.reportSpecResults(spec),adapter.reportSpecResults(spec2),expect(reporter.setSpecStatus).toHaveBeenCalledWith(jasmine.objectContaining({id:244,name:"test 1",suite:jasmine.objectContaining({id:981,name:"Suite 2",parentSuite:jasmine.objectContaining({id:881,name:"Suite 1"})}),status:AllGreen.SpecStatus.Failed})),expect(reporter.setSpecStatus).toHaveBeenCalledWith(jasmine.objectContaining({id:344,name:"test 2",suite:jasmine.objectContaining({id:981,name:"Suite 2",parentSuite:jasmine.objectContaining({id:881,name:"Suite 1"})}),status:AllGreen.SpecStatus.Failed}))})})