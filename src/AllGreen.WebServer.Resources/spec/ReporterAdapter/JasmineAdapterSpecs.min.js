var _this=this;describe("AllGreen JasmineAdapterFactory",function(){it("Creates Jasmine this.adapter",function(){var t=new AllGreen.JasmineAdapterFactory,i=jasmine.createSpyObj("this.reporter",["reset","setServerStatus","started","finished","specUpdated"]),n=t.create(_this.reporter);expect(n).toBeDefined(),expect(n.start).toBeDefined()}),it("Should have the correct name",function(){var n=new AllGreen.JasmineAdapterFactory;expect(n.getName()).toBe("jasmine")})}),describe("AllGreen JasmineAdapter",function(){var n=function(n,t,i){return typeof i=="undefined"&&(i=[]),function(){return{passed:function(){return n},skipped:t,getItems:function(){return i?i:[]}}}},i=function(n){return{type:"log",toString:function(){return n}}},t=function(n,t,i){return{type:"expect",passed:function(){return n},message:t,trace:{stack:i!=null?i:!1}}};beforeEach(function(){jasmine.getEnv().currentSpec.addMatchers({toHaveBeenCalledForSpec:function(n,t,i,r,u,f){var s=this.actual,o={id:n,name:t,suite:jasmine.objectContaining({id:i,name:r}),status:u,time:jasmine.any(Number),steps:[]},e;if(f)for(o.steps=[],e=0;e<f.length;e++)o.steps.push(jasmine.objectContaining(f[e]));return expect(s).toHaveBeenCalledWith(jasmine.objectContaining(o)),!0}}),_this.reporter=jasmine.createSpyObj("reporter",["reset","setServerStatus","started","finished","specUpdated"]),_this.adapter=new AllGreen.JasmineAdapter(_this.reporter);var t={id:881,description:"Suite 1"};_this.suite1Guid="00000000-0000-0000-0000-000000000881",_this.spec={id:244,description:"test 1",suite:t,results:n(!1,!1)},_this.specGuid="00000000-0000-0000-0000-000000000244",_this.spec2={id:344,description:"test 2",suite:t,results:n(!1,!1)},_this.spec2Guid="00000000-0000-0000-0000-000000000344"}),afterEach(function(){_this.adapter=null}),it("Resets reporter on runner starting and displays reporter as started",function(){var n=jasmine.createSpyObj("runner",["specs"]);n.specs.andReturn({length:10}),_this.adapter.reportRunnerStarting(n),expect(_this.reporter.started).toHaveBeenCalledWith(10)}),it("Displays reporter as finished on runner finished",function(){var n=jasmine.createSpyObj("runner",["specs"]);_this.adapter.reportRunnerResults(_this.runner),expect(_this.reporter.finished).toHaveBeenCalled()}),it("Shows started specs as running",function(){_this.adapter.reportSpecStarting(_this.spec),expect(_this.reporter.specUpdated).toHaveBeenCalledForSpec(_this.specGuid,"test 1",_this.suite1Guid,"Suite 1",AllGreen.SpecStatus.Running,null)}),it("Shows passed specs as passed",function(){_this.spec.results=n(!0,!1),_this.adapter.reportSpecResults(_this.spec),expect(_this.reporter.specUpdated).toHaveBeenCalledForSpec(_this.specGuid,"test 1",_this.suite1Guid,"Suite 1",AllGreen.SpecStatus.Passed,null)}),it("Shows failed specs as failed",function(){_this.spec.results=n(!1,!1,[i("log message"),t(!0,"expected something and succeded",""),t(!1,"expected something and failed","trace 1\ntrace 2")]),_this.adapter.reportSpecResults(_this.spec),expect(_this.reporter.specUpdated).toHaveBeenCalledForSpec(_this.specGuid,"test 1",_this.suite1Guid,"Suite 1",AllGreen.SpecStatus.Failed,[{message:"log message"},{message:"expected something and failed",status:AllGreen.SpecStatus.Failed,trace:"trace 1\ntrace 2"}])}),it("Removes jasmine entries from stack",function(){_this.spec.results=n(!1,!1,[t(!1,"msg","jasmine.ExpectationResult@http://localhost:8080/Scripts/jasmine.js:114\ntrace 1\njasmine.Block.prototype.execute@http://localhost:8080/Scripts/jasmine.js:1064\ntrace 2\njasmine.Queue.prototype.next_/onComplete@http://localhost:8080/Scripts/jasmine.js:2092jasmine.Suite.prototype.finish@http://localhost:8080/Scripts/jasmine.js:2478jasmine.Suite.prototype.execute/<@http://localhost:8080/Scripts/jasmine.js:2522")]),_this.adapter.reportSpecResults(_this.spec),expect(_this.reporter.specUpdated).toHaveBeenCalledForSpec(_this.specGuid,"test 1",_this.suite1Guid,"Suite 1",AllGreen.SpecStatus.Failed,[{message:"msg",status:AllGreen.SpecStatus.Failed,trace:"trace 1\ntrace 2"}])}),it("Shows skipped specs as skipped",function(){_this.spec.results=n(!1,!0),_this.adapter.reportSpecResults(_this.spec),expect(_this.reporter.specUpdated).toHaveBeenCalledForSpec(_this.specGuid,"test 1",_this.suite1Guid,"Suite 1",AllGreen.SpecStatus.Skipped,null)}),it("Shows specs from same suite as results from same suite",function(){_this.adapter.reportSpecResults(_this.spec),_this.adapter.reportSpecResults(_this.spec2),expect(_this.reporter.specUpdated).toHaveBeenCalledForSpec(_this.specGuid,"test 1",_this.suite1Guid,"Suite 1",AllGreen.SpecStatus.Failed,null),expect(_this.reporter.specUpdated).toHaveBeenCalledForSpec(_this.spec2Guid,"test 2",_this.suite1Guid,"Suite 1",AllGreen.SpecStatus.Failed,null)}),it("Shows nested suites",function(){var n={id:981,description:"Suite 2",parentSuite:{id:881,description:"Suite 1"}};_this.spec.suite=n,_this.spec2.suite=n,_this.adapter.reportSpecResults(_this.spec),_this.adapter.reportSpecResults(_this.spec2),expect(_this.reporter.specUpdated).toHaveBeenCalledWith(jasmine.objectContaining({id:_this.specGuid,name:"test 1",suite:jasmine.objectContaining({id:"00000000-0000-0000-0000-000000000981",name:"Suite 2",parentSuite:jasmine.objectContaining({id:_this.suite1Guid,name:"Suite 1"})}),status:AllGreen.SpecStatus.Failed})),expect(_this.reporter.specUpdated).toHaveBeenCalledWith(jasmine.objectContaining({id:_this.spec2Guid,name:"test 2",suite:jasmine.objectContaining({id:"00000000-0000-0000-0000-000000000981",name:"Suite 2",parentSuite:jasmine.objectContaining({id:_this.suite1Guid,name:"Suite 1"})}),status:AllGreen.SpecStatus.Failed}))}),it("Should convert number to GUID",function(){[{id:123,guid:"00000000-0000-0000-0000-000000000123"},{id:9000000123,guid:"00000000-0000-0000-0000-009000000123"},{id:80009000000123,guid:"00000000-0000-0000-0080-009000000123"},{id:70000009000000120,guid:"00000000-0000-0007-0000-009000000120"}].forEach(function(n){expect(AllGreen.JasmineAdapter.convertIdToGuid(n.id)).toBe(n.guid)})})})