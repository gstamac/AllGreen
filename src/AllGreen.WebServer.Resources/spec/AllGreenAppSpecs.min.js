var _this=this;describe("App",function(){beforeEach(function(){jasmine.getFixtures().fixturesPath="";var n=readFixtures("Client/client.html");expect(n).not.toBe(""),n=n.replace(/~internal~\//g,""),n=n.replace(/<script[^>]*><\/script>/g,""),n=n.replace(/<script[^>]*>[^<]*new AllGreen\.App()[^<]*<\/script>/g,""),setFixtures(n),_this.app=new AllGreen.App}),afterEach(function(){_this.app=null}),it("Reports server status",function(){var n=jasmine.createSpyObj("serverReporter",["setServerStatus"]);_this.app.setServerReporter(n),_this.app.setServerStatus("server status"),expect(n.setServerStatus).toHaveBeenCalledWith("server status")}),it("Checks isReady for all reporters",function(){var t={isReady:function(){return!0}},n;_this.app.registerRunnerReporter(t),n={isReady:function(){return!1}},_this.app.registerRunnerReporter(n),expect(_this.app.isReady()).toBeFalsy(),n.isReady=function(){return!0},expect(_this.app.isReady()).toBeTruthy()}),["reset","started","finished","specUpdated"].forEach(function(n){it("Forwards '"+n+"' to multiple reporters",function(){var i=jasmine.createSpyObj("runnerReporter1",[n]),t;_this.app.registerRunnerReporter(i),t=jasmine.createSpyObj("runnerReporter2",[n]),_this.app.registerRunnerReporter(t),_this.app[n](),expect(i[n]).toHaveBeenCalled(),expect(t[n]).toHaveBeenCalled()})});var n=function(n){var t=jasmine.createSpyObj("adapterFactory",["create","getName"]);return t.create.andReturn({start:function(){}}),t.getName.andReturn(n),this.app.registerAdapterFactory(t),t},t=function(n){var i=jasmine.createSpyObj("adapter",["start"]),t=jasmine.createSpyObj("adapterFactory",["create","getName"]);return t.create.andReturn(i),t.getName.andReturn(n),this.app.registerAdapterFactory(t),i};it("Creates adapters on run tests",function(){var t=n("adapter1"),i=n("adapter2");_this.app.runTests(),expect(t.create).toHaveBeenCalledWith(_this.app),expect(i.create).toHaveBeenCalledWith(_this.app)}),it("Should run tests after all reporters are ready",function(){var t=n("adapter"),i={isReady:function(){return!1}};runs(function(){_this.app.registerRunnerReporter(i),_this.app.runTests(),expect(t.create.callCount).toBe(0),i.isReady=function(){return!0}}),waits(20),runs(function(){expect(t.create).toHaveBeenCalledWith(_this.app)})}),it("Adapters start is called",function(){var n=t("adapter1"),i=t("adapter2");_this.app.runTests(),expect(n.start).toHaveBeenCalled(),expect(i.start).toHaveBeenCalled()}),it("Can be reloaded",function(){var t=jasmine.createSpyObj("runnerReporter",["reset","isReady"]),i;t.isReady.andCallFake(function(){return!0}),_this.app.registerRunnerReporter(t),i=n("adapter1"),_this.app.reload(),expect(t.reset).toHaveBeenCalled(),expect($("#runner-iframe")).toHaveAttr("src","/~internal~/Client/runner.html"),_this.app.runTests(),expect(i.create).not.toHaveBeenCalled()}),it("Registeres only first adapter factory with same name",function(){var t=n("adapter1"),i=n("adapter2"),r=n("adapter1");_this.app.registerAdapterFactory(t),_this.app.registerAdapterFactory(i),_this.app.registerAdapterFactory(r),_this.app.runTests(),expect(t.create).toHaveBeenCalledWith(_this.app),expect(i.create).toHaveBeenCalledWith(_this.app),expect(r.create).not.toHaveBeenCalled()}),it("Enables reconnect by default",function(){expect(_this.app.reconnectEnabled).toBeTruthy()}),it("Can enable/disable reconnect",function(){_this.app.enableReconnect(!0),expect(_this.app.reconnectEnabled).toBeTruthy(),_this.app.enableReconnect(!1),expect(_this.app.reconnectEnabled).toBeFalsy(),_this.app.enableReconnect(!0),expect(_this.app.reconnectEnabled).toBeTruthy()})})